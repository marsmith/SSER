webpackJsonp([0],{18:function(e,t,a){(function(e,t,a,r){function n(e,a){var r=parseInt(t(a).attr("value")),n=mapServer.getLayers(),o=-1;n&&(o=n.indexOf(r)),o>-1?(n.splice(o,1),0===n.length?k.removeLayer(mapServer):mapServer.setLayers(n),t(a).removeClass("slick-btn-selection")):(t(a).addClass("slick-btn-selection"),n.push(r),mapServer.setLayers(n))}function o(e){var a=mapServer.getLayers();a.length>0&&mapServer.identify().on(k).at(e.latlng).layers("visible:"+a[0]).run(function(a,r){r.features.length>0&&t.each(r.features,function(a,r){k.hasLayer(T)&&k.removeLayer(T),T=L.geoJson(r).addTo(k),t.each(x.layers,function(a,n){if(n.layerId===r.layerId){var o="<h5>"+n.layerName+"</h5>";t.each(r.properties,function(e,t){o+="<strong>"+e+": </strong>"+t+"</br>"}),popup=L.popup().setLatLng(e.latlng).setContent(o).openOn(k)}})})})}function l(a,r,n,o){var l=t(a.target).attr("id"),c=l.replace("-select",""),p=t(a.target).find("option:selected"),u=p.length,f=t(a.target).find("option")[r],d=t(f).attr("value");t(f).text();if(0===u){var m=R.indexOf(l);m>-1&&R.splice(m,1)}if(t.each(t("#geoFilterSelect").find("option:selected"),function(e,a){var r=t(a).parent().attr("id");-1===R.indexOf(r)&&R.push(r)}),!1===n)for(console.log("Removing the filter:",c,d),i=0;i<j.length;i++)j[i].selectName==c&&j[i].optionValue==d&&j.splice(i,1);else{var g={selectName:c,optionValue:d};j.push(g)}if(0===u&&0===R.length)return e.info("You just unselected all options, resetting filters","Info"),void w();e.info("Querying sites...",{timeOut:0,extendedTimeOut:0}),R.length>1?s(j,"AND"):s(j,"OR")}function s(a,r){F={};var n=[];t.each(a,function(e,t){"Parameter2"===t.selectName?n.push(a[e].selectName+" LIKE '%"+a[e].optionValue+"%'"):n.push(a[e].selectName+"='"+a[e].optionValue+"'")}),F[1]=n.join(" "+r+" "),console.log("complete queryString:",F),mapServer.setLayerDefs(F),e.clear(),e.info("Site query completed",{timeOut:5e3})}function c(){mapServer=a.dynamicMapLayer(P),k.addLayer(mapServer),p(mapServer,P)}function p(e,a){t.getJSON(a.url+"/legend?f=json",function(e){x=e,t.each(x.layers,function(e,r){var n=N(r.layerName);if(1===r.legend.length)t("#baseLayerToggles").append('<button id="'+D(r.layerName)+'" class="btn btn-default slick-btn layerToggle" value="'+r.layerId+'"><img alt="Legend Swatch" src="data:image/png;base64,'+r.legend[0].imageData+'" />'+n+"</button>");else{var o=D(r.layerName.replace(/[{()}]/g,""));t("#baseLayerToggles").append('<div id="'+o+'_group"></div>'),t("#"+o+"_group").append('<button id="'+o+'" class="btn btn-default slick-btn layerToggle" value="'+r.layerId+'">'+n+"</button>"),t.each(r.legend,function(e,a){t("#"+o+"_group").append('<div class="subitem" </br><img alt="Legend Swatch" src="data:image/png;base64,'+a.imageData+'" /><span>'+a.label+"</span></div>")})}-1!=a.layers.indexOf(r.layerId)&&t("#"+o).addClass("slick-btn-selection")})})}function u(){t(".selectpicker").each(function(){var e=t(this).attr("id"),a=t("#"+e+" option").get();a.sort(function(e,a){var r=t(e).text(),n=t(a).text();return r<n?-1:r>n?1:0});var r=t("#"+e);t.each(a,function(e,t){r.append(t)})}),t(".selectpicker").selectpicker("refresh")}function f(){t.each(J,function(e,a){t("#geoFilterSelect").append("<select id='"+a.layerName+"' class='selectpicker geoFilterSelect' multiple data-selected-text-format='count' data-header='"+a.label+"'title='"+a.label+"'></select>")}),mapServer.query().layer("1").where("1=1").ids(function(e,a){for(var r=Math.ceil(a.length/1e3),n=0;n<r;n++){var o=1e3*n;mapServer.query().layer("1").where("OBJECTID>= "+o+" and OBJECTID< "+o+1e3).run(function(e,a){a&&a.features.length>0&&t.each(a.features,function(e,a){t.each(a.properties,function(e,a){t.each(J,function(r,n){if(n.layerName===e)if("Parameter2"===n.layerName){var o=a.split(",");t.each(o,function(e,t){var a=t.trim();d(a,a,"#"+n.layerName)})}else d(a,a,"#"+n.layerName)})})}),u()})}})}function d(e,a,r){e&&"na"!==e&&0===t(r+' option[value="'+e+'"]').length&&t(r).append(t("<option></option>").attr("value",e).text(a))}function m(e){t.isEmptyObject(F)&&(F={1:"1=1"}),t.each(F,function(t,a){mapServer.query().layer(t).where(a).ids(function(r,n){if(console.log("total sites:",n.length),n.length<1e3)mapServer.query().layer(t).where(a).run(function(t,a){console.log(a),e(a)});else for(var o=Math.ceil(n.length/1e3),i=[],l=0;l<o;l++){var s=1e3*l;mapServer.query().layer(t).where(a+" and OBJECTID>= "+s+" and OBJECTID< "+s+1e3).run(function(t,a){a.features.forEach(function(e){i.push(e)}),i.length===n.length&&e({type:"FeatureCollection",features:i})})}})})}function g(){console.log("HERE"),m(function(t){if(t.features[0]){v(JSON.stringify(t),"data.geojson")}else e.error("Error","No sites to export",{timeOut:0})})}function y(){m(function(t){if(t.features[0]){var a=t.features[0];v(r(a),"data.kml")}else e.error("Error","No sites to export",{timeOut:0})})}function h(){m(function(t){if(t.features[0]){var a=Object.keys(t.features[0].properties),r=[];r.push(a.join(",")),t.features.forEach(function(e){var t=[];a.forEach(function(a){var r="";e.properties[a]&&(r=e.properties[a].toString()),console.log("here",a,r),t.push(r)}),r.push(t)}),r=r.join("\n");v(r,"data.csv")}else e.error("Error","No sites to export",{timeOut:0})})}function v(e,t){var a=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,t);else{var r=document.createElement("a"),n=URL.createObjectURL(a);void 0!==r.download?(r.setAttribute("href",n),r.setAttribute("download",t),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(n)}}function b(e){C&&k.removeLayer(C),C=a.basemapLayer(e),k.addLayer(C),I&&k.removeLayer(I),"ShadedRelief"!==e&&"Oceans"!==e&&"Gray"!==e&&"DarkGray"!==e&&"Imagery"!==e&&"Terrain"!==e||(I=a.basemapLayer(e+"Labels"),k.addLayer(I))}function S(){t(".selectpicker").selectpicker("deselectAll"),R=[],j=[],mapServer.setLayerDefs({})}function w(){t("#showConstituentFilterSelect").show(),t("#geoFilterSelect").show(),t("#constituentFilterSelect").hide(),S(),k.setView([A,E],B)}function D(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/[\[\]']+/g,"").replace(/\s+/g,"")}function N(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/\b([A-Z]+)([A-Z])([a-z])/,"$1 $2$3").replace(/^./,function(e){return e.toUpperCase()})}var k,O,C,I,T,x,E="-73.15",A="40.7",B=10,j=[],F={},J=[{layerName:"Resp_Org",dropDownID:"RespOrg",label:"Responsible Organization"},{layerName:"Site_Type",dropDownID:"SiteType",label:"Site Type"},{layerName:"Samp_Type",dropDownID:"SampType",label:"Sample Type"},{layerName:"Parameter2",dropDownID:"Parameter2",label:"Parameters"},{layerName:"Date_Category",dropDownID:"DateCategory",label:"Monitoring Status"},{layerName:"DataPublic",dropDownID:"DataPublic",label:"Data Public"},{layerName:"Name",dropDownID:"Name",label:"Waterbody"}],P={url:"https://www.sciencebase.gov/arcgis/rest/services/Catalog/587fba36e4b085de6c11f3e8/MapServer",layers:[1,11,12,18,19],visible:!0,opacity:.8},R=[];e.options={positionClass:"toast-bottom-right"},t(document).ready(function(){console.log("Application Information: production version 0.0.0"),t("#appVersion").html("Application Information: production version 0.0.0"),k=L.map("mapDiv",{zoomControl:!1}),L.Icon.Default.imagePath="./images/",L.control.zoom({position:"topright"}).addTo(k),L.control.scale().addTo(k),t("#mapDiv").css("cursor","pointer"),C=a.basemapLayer("DarkGray").addTo(k),k.setView([A,E],B),O=L.featureGroup().addTo(k),c(),f(),t("#mobile-main-menu").click(function(){t("body").toggleClass("isOpenMenu")}),t(".basemapBtn").click(function(){t(".basemapBtn").removeClass("slick-btn-selection"),t(this).addClass("slick-btn-selection"),b(this.id.replace("btn",""))}),t("#resetView").click(function(){w()}),t("#resetFilters").click(function(){S()}),t("#aboutButton").click(function(){t("#aboutModal").modal("show")}),t("#exportGeoJSON").click(function(){g()}),t("#exportKML").click(function(){y()}),t("#exportCSV").click(function(){h()}),t("#geoFilterSelect").on("changed.bs.select",function(e,t,a,r){l(e,t,a,r)}),k.on("click",function(e){o(e)}),t("#baseLayerToggles").on("click",".layerToggle",function(e){n(e,this)})})}).call(t,a(4),a(0),a(3),a(5))}},[18]);