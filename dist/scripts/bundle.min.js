webpackJsonp([0],{18:function(e,t,a){(function(e,t,a,n){function r(e,a){var n=parseInt(t(a).attr("value")),r=C.getLayers(),o=-1;r&&(o=r.indexOf(n)),o>-1?(r.splice(o,1),0===r.length&&N.hasLayer(C)?N.removeLayer(C):C.setLayers(r),t(a).removeClass("slick-btn-selection"),t(a).blur()):(t(a).addClass("slick-btn-selection"),r.push(n),C.setLayers(r),-1!=o||N.hasLayer(C)||N.addLayer(C))}function o(a){e.info("Querying clicked point...",{timeOut:0,extendedTimeOut:0}),C.identify().on(N).at(a.latlng).layers("visible:all").run(function(n,r){r.features.length>0&&(console.log(r),e.clear(),t.each(r.features,function(e,n){t.each(S.layers,function(e,r){if(r.layerId===n.layerId){var o="<h5>"+r.layerName+"</h5>";t.each(n.properties,function(e,t){o+="<strong>"+e+": </strong>"+t+"</br>"}),popup=L.popup({maxHeight:200}).setLatLng(a.latlng).setContent(o).openOn(N)}})}))})}function l(a,n,r,o){var l=t(a.target).attr("id"),c=l.replace("-select",""),u=t(a.target).find("option:selected"),p=u.length,f=t(a.target).find("option")[n],d=t(f).attr("value");t(f).text();if(0===p){var g=j.indexOf(l);g>-1&&j.splice(g,1)}if(t.each(t("#geoFilterSelect").find("option:selected"),function(e,a){var n=t(a).parent().attr("id");-1===j.indexOf(n)&&j.push(n)}),!1===r)for(console.log("Removing the filter:",c,d),i=0;i<E.length;i++)E[i].selectName==c&&E[i].optionValue==d&&E.splice(i,1);else{var y={selectName:c,optionValue:d};E.push(y)}if(0===p&&0===j.length)return e.info("You just unselected all options, resetting filters","Info"),void v();e.info("Querying sites...",{timeOut:0,extendedTimeOut:0}),j.length>1?s(E,"AND"):s(E,"OR")}function s(a,n){F={};var r=[];t.each(a,function(e,t){"Parameter"===t.selectName?r.push(a[e].selectName+" LIKE '%"+a[e].optionValue+"%'"):r.push(a[e].selectName+"='"+a[e].optionValue+"'")});var o=r.join(" "+n+" ");F={2:o,3:o,5:o,6:o},C.setLayerDefs(F),e.clear(),e.info("Site query completed",{timeOut:5e3})}function c(){C=a.dynamicMapLayer(B),N.addLayer(C),u(C,B)}function u(e,a){t.getJSON(a.url+"/legend?f=json",function(e){S=e,t.each(S.layers,function(e,n){var r=D(n.layerName),o=w(n.layerName.replace(/[{()}]/g,""));1===n.legend.length?t("#baseLayerToggles").append('<button id="'+w(n.layerName)+'" class="btn btn-default slick-btn layerToggle" value="'+n.layerId+'"><img alt="Legend Swatch" src="data:image/png;base64,'+n.legend[0].imageData+'" />'+r+"</button>"):(t("#baseLayerToggles").append('<div id="'+o+'_group"></div>'),t("#"+o+"_group").append('<button id="'+o+'" class="btn btn-default slick-btn layerToggle" value="'+n.layerId+'">'+r+"</button>"),t.each(n.legend,function(e,a){t("#"+o+"_group").append('<div class="subitem" </br><img alt="Legend Swatch" src="data:image/png;base64,'+a.imageData+'" /><span>'+a.label+"</span></div>")})),-1!=a.layers.indexOf(n.layerId)&&t("#"+o).addClass("slick-btn-selection")})})}function p(){t(".selectpicker").each(function(){var e=t(this).attr("id"),a=t("#"+e+" option").get();a.sort(function(e,a){var n=t(e).text(),r=t(a).text();return n<r?-1:n>r?1:0});var n=t("#"+e);t.each(a,function(e,t){n.append(t)})}),t(".selectpicker").selectpicker("refresh")}function f(){t.each(A,function(e,a){t("#geoFilterSelect").append("<select id='"+a.layerName+"' class='selectpicker geoFilterSelect' multiple data-selected-text-format='count' data-header='"+a.label+"'title='"+a.label+"'></select>")}),t.each(F,function(e,a){C.query().layer(e).where(a).ids(function(a,n){if(a)console.log("There was an error populating filters:",a);else for(var r=Math.ceil(n.length/1e3),o=0;o<r;o++){var i=1e3*o;C.query().layer(e).where("OBJECTID>= "+i+" and OBJECTID< "+i+1e3).run(function(e,a){e?console.log("There was an error populating filters:",e):a&&a.features.length>0?(t.each(a.features,function(e,a){t.each(a.properties,function(e,a){t.each(A,function(n,r){if(r.layerName===e)if("Parameter"===r.layerName){var o=a.split(",");t.each(o,function(e,t){var a=t.trim();d(a,a,"#"+r.layerName)})}else d(a,a,"#"+r.layerName)})})}),p()):console.log("No features were returned")})}})})}function d(e,a,n){e&&"na"!==e&&0===t(n+' option[value="'+e+'"]').length&&t(n).append(t("<option></option>").attr("value",e).text(a))}function g(a){t.each(F,function(t,n){C.query().layer(t).where(n).ids(function(r,o){if(r)console.log("There was an error with the export:",r),e.error("Error","Problem with export, maybe no sites",{timeOut:0});else if(o)if(o.length<1e3)C.query().layer(t).where(n).run(function(e,t){a(t)});else for(var i=Math.ceil(o.length/1e3),l=[],s=0;s<i;s++){var c=1e3*s;C.query().layer(t).where(n+" and OBJECTID>= "+c+" and OBJECTID< "+c+1e3).run(function(e,t){t.features.forEach(function(e){l.push(e)}),l.length===o.length&&a({type:"FeatureCollection",features:l})})}else console.log("No sites returned for layer",t,"with query",n),a({type:"FeatureCollection",features:[]})})})}function y(t){var a=Object.keys(F).length,r=0,o=[];g(function(i){if(r+=1,i.features.forEach(function(e){o.push(e)}),r===a){if(0==o.length)return void e.error("Error","No sites to export",{timeOut:0});var l={type:"FeatureCollection",features:o};if("geoJSON"===t){var s="data.geojson";h(JSON.stringify(l),s)}if("KML"===t){var c=n(l),s="data.kml";h(c,s)}if("CSV"===t){var u=Object.keys(l.features[0].properties),p=[];p.push(u.join(",")),l.features.forEach(function(e){var t=[];u.forEach(function(a){var n="";if(e.properties[a]){var r=e.properties[a];r=r.toString(),r=r.replace(/^\s+|\s+$/g,""),n=r.replace(",",";")}t.push(n)}),p.push(t)}),p=p.join("\n");var s="data.csv";h(p,s)}}})}function h(e,t){var a=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,t);else{var n=document.createElement("a"),r=URL.createObjectURL(a);void 0!==n.download?(n.setAttribute("href",r),n.setAttribute("download",t),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)):window.open(r)}}function m(e){k&&N.removeLayer(k),k=a.basemapLayer(e),N.addLayer(k),O&&N.removeLayer(O),"ShadedRelief"!==e&&"Oceans"!==e&&"Gray"!==e&&"DarkGray"!==e&&"Imagery"!==e&&"Terrain"!==e||(O=a.basemapLayer(e+"Labels"),N.addLayer(O))}function b(){t(".selectpicker").selectpicker("deselectAll"),j=[],E=[],C.setLayerDefs({})}function v(){t("#showConstituentFilterSelect").show(),t("#geoFilterSelect").show(),t("#constituentFilterSelect").hide(),b(),N.setView([I,T],x)}function w(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/[\[\]']+/g,"").replace(/\s+/g,"")}function D(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/\b([A-Z]+)([A-Z])([a-z])/,"$1 $2$3").replace(/^./,function(e){return e.toUpperCase()})}var N,k,O,C,S,T="-73.15",I="40.7",x=10,E=[],F={2:"1=1",3:"1=1",4:"1=1",5:"1=1"},A=[{layerName:"Resp_Org",dropDownID:"RespOrg",label:"Responsible Organization"},{layerName:"Site_Type",dropDownID:"SiteType",label:"Site Type"},{layerName:"Samp_Type",dropDownID:"SampType",label:"Sample Type"},{layerName:"Parameter",dropDownID:"Parameter",label:"Constituents"},{layerName:"Date_Category",dropDownID:"DateCategory",label:"Monitoring Status"},{layerName:"DataPublic",dropDownID:"DataPublic",label:"Data Public"},{layerName:"Name",dropDownID:"Name",label:"Waterbody"}],B={url:"https://www.sciencebase.gov/arcgis/rest/services/Catalog/587fba36e4b085de6c11f3e8/MapServer",layers:[2,3,5,6,24],visible:!0,opacity:.8},j=[];e.options={positionClass:"toast-bottom-right"},t(document).ready(function(){console.log("Application Information: production version 1.0.0"),t("#appVersion").html("Application Information: production version 1.0.0"),N=L.map("mapDiv",{zoomControl:!1}),L.Icon.Default.imagePath="./images/",L.control.zoom({position:"topright"}).addTo(N),L.control.scale().addTo(N),t("#mapDiv").css("cursor","pointer"),k=a.basemapLayer("DarkGray").addTo(N),N.setView([I,T],x),c(),f(),t("#mobile-main-menu").click(function(){t("body").toggleClass("isOpenMenu")}),t(".basemapBtn").click(function(){t(".basemapBtn").removeClass("slick-btn-selection"),t(this).addClass("slick-btn-selection"),m(this.id.replace("btn",""))}),t("#resetView").click(function(){v()}),t("#resetFilters").click(function(){b()}),t("#aboutButton").click(function(){t("#aboutModal").modal("show")}),t(".download-data").click(function(){y(this.id)}),t("#geoFilterSelect").on("changed.bs.select",function(e,t,a,n){l(e,t,a,n)}),N.on("click",function(e){o(e)}),t("#baseLayerToggles").on("click",".layerToggle",function(e){r(e,this)})})}).call(t,a(4),a(0),a(3),a(5))}},[18]);