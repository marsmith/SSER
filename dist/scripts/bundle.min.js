webpackJsonp([0],{18:function(e,t,a){(function(e,t,a,r){function n(e,a){var r=parseInt(t(a).attr("value")),n=mapServer.getLayers(),o=-1;n&&(o=n.indexOf(r)),o>-1?(n.splice(o,1),0===n.length?D.removeLayer(mapServer):mapServer.setLayers(n),t(a).removeClass("slick-btn-selection"),t(a).blur()):(t(a).addClass("slick-btn-selection"),n.push(r),mapServer.setLayers(n))}function o(a){e.info("Querying clicked point...",{timeOut:0,extendedTimeOut:0}),mapServer.identify().on(D).at(a.latlng).layers("visible:all").run(function(r,n){n.features.length>0&&(console.log(n),e.clear(),t.each(n.features,function(e,r){t.each(O.layers,function(e,n){if(n.layerId===r.layerId){var o="<h5>"+n.layerName+"</h5>";t.each(r.properties,function(e,t){o+="<strong>"+e+": </strong>"+t+"</br>"}),popup=L.popup({maxHeight:200}).setLatLng(a.latlng).setContent(o).openOn(D)}})}))})}function l(a,r,n,o){var l=t(a.target).attr("id"),c=l.replace("-select",""),u=t(a.target).find("option:selected"),p=u.length,f=t(a.target).find("option")[r],d=t(f).attr("value");t(f).text();if(0===p){var g=B.indexOf(l);g>-1&&B.splice(g,1)}if(t.each(t("#geoFilterSelect").find("option:selected"),function(e,a){var r=t(a).parent().attr("id");-1===B.indexOf(r)&&B.push(r)}),!1===n)for(console.log("Removing the filter:",c,d),i=0;i<x.length;i++)x[i].selectName==c&&x[i].optionValue==d&&x.splice(i,1);else{var m={selectName:c,optionValue:d};x.push(m)}if(0===p&&0===B.length)return e.info("You just unselected all options, resetting filters","Info"),void b();e.info("Querying sites...",{timeOut:0,extendedTimeOut:0}),B.length>1?s(x,"AND"):s(x,"OR")}function s(a,r){E={};var n=[];t.each(a,function(e,t){"Parameter"===t.selectName?n.push(a[e].selectName+" LIKE '%"+a[e].optionValue+"%'"):n.push(a[e].selectName+"='"+a[e].optionValue+"'")});var o=n.join(" "+r+" ");E={2:o,3:o,5:o,6:o},mapServer.setLayerDefs(E),e.clear(),e.info("Site query completed",{timeOut:5e3})}function c(){mapServer=a.dynamicMapLayer(A),D.addLayer(mapServer),u(mapServer,A)}function u(e,a){t.getJSON(a.url+"/legend?f=json",function(e){O=e,t.each(O.layers,function(e,r){var n=S(r.layerName);if(1===r.legend.length)t("#baseLayerToggles").append('<button id="'+w(r.layerName)+'" class="btn btn-default slick-btn layerToggle" value="'+r.layerId+'"><img alt="Legend Swatch" src="data:image/png;base64,'+r.legend[0].imageData+'" />'+n+"</button>");else{var o=w(r.layerName.replace(/[{()}]/g,""));t("#baseLayerToggles").append('<div id="'+o+'_group"></div>'),t("#"+o+"_group").append('<button id="'+o+'" class="btn btn-default slick-btn layerToggle" value="'+r.layerId+'">'+n+"</button>"),t.each(r.legend,function(e,a){t("#"+o+"_group").append('<div class="subitem" </br><img alt="Legend Swatch" src="data:image/png;base64,'+a.imageData+'" /><span>'+a.label+"</span></div>")})}-1!=a.layers.indexOf(r.layerId)&&t("#"+o).addClass("slick-btn-selection")})})}function p(){t(".selectpicker").each(function(){var e=t(this).attr("id"),a=t("#"+e+" option").get();a.sort(function(e,a){var r=t(e).text(),n=t(a).text();return r<n?-1:r>n?1:0});var r=t("#"+e);t.each(a,function(e,t){r.append(t)})}),t(".selectpicker").selectpicker("refresh")}function f(){t.each(F,function(e,a){t("#geoFilterSelect").append("<select id='"+a.layerName+"' class='selectpicker geoFilterSelect' multiple data-selected-text-format='count' data-header='"+a.label+"'title='"+a.label+"'></select>")}),t.each(E,function(e,a){mapServer.query().layer(e).where(a).ids(function(a,r){if(a)console.log("There was an error populating filters:",a);else for(var n=Math.ceil(r.length/1e3),o=0;o<n;o++){var i=1e3*o;mapServer.query().layer(e).where("OBJECTID>= "+i+" and OBJECTID< "+i+1e3).run(function(e,a){e?console.log("There was an error populating filters:",e):a&&a.features.length>0?(t.each(a.features,function(e,a){t.each(a.properties,function(e,a){t.each(F,function(r,n){if(n.layerName===e)if("Parameter"===n.layerName){var o=a.split(",");t.each(o,function(e,t){var a=t.trim();d(a,a,"#"+n.layerName)})}else d(a,a,"#"+n.layerName)})})}),p()):console.log("No features were returned")})}})})}function d(e,a,r){e&&"na"!==e&&0===t(r+' option[value="'+e+'"]').length&&t(r).append(t("<option></option>").attr("value",e).text(a))}function g(a){t.each(E,function(t,r){mapServer.query().layer(t).where(r).ids(function(n,o){if(n)console.log("There was an error with the export:",n),e.error("Error","Problem with export, maybe no sites",{timeOut:0});else if(o)if(o.length<1e3)mapServer.query().layer(t).where(r).run(function(e,t){a(t)});else for(var i=Math.ceil(o.length/1e3),l=[],s=0;s<i;s++){var c=1e3*s;mapServer.query().layer(t).where(r+" and OBJECTID>= "+c+" and OBJECTID< "+c+1e3).run(function(e,t){t.features.forEach(function(e){l.push(e)}),l.length===o.length&&a({type:"FeatureCollection",features:l})})}else console.log("No sites returned for layer",t,"with query",r),a({type:"FeatureCollection",features:[]})})})}function m(t){var a=Object.keys(E).length,n=0,o=[];g(function(i){if(n+=1,i.features.forEach(function(e){o.push(e)}),n===a){if(0==o.length)return void e.error("Error","No sites to export",{timeOut:0});var l={type:"FeatureCollection",features:o};if("geoJSON"===t){var s="data.geojson";y(JSON.stringify(l),s)}if("KML"===t){var c=r(l),s="data.kml";y(c,s)}if("CSV"===t){var u=Object.keys(l.features[0].properties),p=[];p.push(u.join(",")),l.features.forEach(function(e){var t=[];u.forEach(function(a){var r="";if(e.properties[a]){var n=e.properties[a];n=n.toString(),n=n.replace(/^\s+|\s+$/g,""),r=n.replace(",",";")}t.push(r)}),p.push(t)}),p=p.join("\n");var s="data.csv";y(p,s)}}})}function y(e,t){var a=new Blob([e],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,t);else{var r=document.createElement("a"),n=URL.createObjectURL(a);void 0!==r.download?(r.setAttribute("href",n),r.setAttribute("download",t),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)):window.open(n)}}function h(e){N&&D.removeLayer(N),N=a.basemapLayer(e),D.addLayer(N),k&&D.removeLayer(k),"ShadedRelief"!==e&&"Oceans"!==e&&"Gray"!==e&&"DarkGray"!==e&&"Imagery"!==e&&"Terrain"!==e||(k=a.basemapLayer(e+"Labels"),D.addLayer(k))}function v(){t(".selectpicker").selectpicker("deselectAll"),B=[],x=[],mapServer.setLayerDefs({})}function b(){t("#showConstituentFilterSelect").show(),t("#geoFilterSelect").show(),t("#constituentFilterSelect").hide(),v(),D.setView([T,C],I)}function w(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()}).replace(/[\[\]']+/g,"").replace(/\s+/g,"")}function S(e){return e.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/\b([A-Z]+)([A-Z])([a-z])/,"$1 $2$3").replace(/^./,function(e){return e.toUpperCase()})}var D,N,k,O,C="-73.15",T="40.7",I=10,x=[],E={2:"1=1",3:"1=1",4:"1=1",5:"1=1"},F=[{layerName:"Resp_Org",dropDownID:"RespOrg",label:"Responsible Organization"},{layerName:"Site_Type",dropDownID:"SiteType",label:"Site Type"},{layerName:"Samp_Type",dropDownID:"SampType",label:"Sample Type"},{layerName:"Parameter",dropDownID:"Parameter",label:"Constituents"},{layerName:"Date_Category",dropDownID:"DateCategory",label:"Monitoring Status"},{layerName:"DataPublic",dropDownID:"DataPublic",label:"Data Public"},{layerName:"Name",dropDownID:"Name",label:"Waterbody"}],A={url:"https://www.sciencebase.gov/arcgis/rest/services/Catalog/587fba36e4b085de6c11f3e8/MapServer",layers:[2,3,5,6,24],visible:!0,opacity:.8},B=[];e.options={positionClass:"toast-bottom-right"},t(document).ready(function(){console.log("Application Information: production version 0.0.0"),t("#appVersion").html("Application Information: production version 0.0.0"),D=L.map("mapDiv",{zoomControl:!1}),L.Icon.Default.imagePath="./images/",L.control.zoom({position:"topright"}).addTo(D),L.control.scale().addTo(D),t("#mapDiv").css("cursor","pointer"),N=a.basemapLayer("DarkGray").addTo(D),D.setView([T,C],I),c(),f(),t("#mobile-main-menu").click(function(){t("body").toggleClass("isOpenMenu")}),t(".basemapBtn").click(function(){t(".basemapBtn").removeClass("slick-btn-selection"),t(this).addClass("slick-btn-selection"),h(this.id.replace("btn",""))}),t("#resetView").click(function(){b()}),t("#resetFilters").click(function(){v()}),t("#aboutButton").click(function(){t("#aboutModal").modal("show")}),t(".download-data").click(function(){m(this.id)}),t("#geoFilterSelect").on("changed.bs.select",function(e,t,a,r){l(e,t,a,r)}),D.on("click",function(e){o(e)}),t("#baseLayerToggles").on("click",".layerToggle",function(e){n(e,this)})})}).call(t,a(4),a(0),a(3),a(5))}},[18]);